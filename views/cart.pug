extends layout

block content
    <script src="https://js.stripe.com/v3/"></script>
    script(src="https://checkout.stripe.com/checkout.js")
    if user
        script(defer).
            var stripePublicKey = "#{stripePublicKey}"
            var cart = [!{cart}]
        script(src='../javascripts/cart.js')
        <script src="https://js.stripe.com/v3/"></script>
    if user
        .cartbody
            .container.cartcont(style='top: 65px !important; position: relative;')
                .cart-q
                    h2
                        i(class="large material-icons") shopping_bag
                    h7 #{user.username}'s shopping cart:
                    - var i = 0
                    while i <= cart.length-1
                        .r(data-item-id = ids[i] data-stripe-id = stripe.find(element => element.name == cart[i].name).id)
                            span ##{i+1}.
                            a.name(href='/scents/'+cart[i].mw) #{cart[i].name}
                            label(for='quantity') Quantity
                            input.q(type="number" name="quantity" min="1" max="100" value='1')
                            .btn.btn-prymary.remove-cart-item
                                i.material-icons.large remove_circle
                        - i++
                    if false
                        if user.status == 'verified' && user.addresses
                            .cardinfo
                                <form action="/scents/purchase" method="post" id="payment-form">
                                    <div class="form-row">
                                        <label for="card-element">Credit or debit card</label>
                                        <div id="card-element"></div>
                                        <div id="card-errors" role="alert"></div>
                                    </div>
                                </form>
                                .btn.buybutton.ndcolor.btn.largebtn(onclick = 'purchaseClicked()') Start Payment
                                span.wariningafterclick(style='display: none;') Payment intent was sent! Wait for success/error message!
                        else
                            .content
                                .verif You need to verify your account and add a <a href='/myaccount' style='color: lime !important; text-decoration: underline;'>delivery address</a> to be able to purchase!
                        br
                        br
                    else 
                        .btn.cbutton.ndcolor.btn.largebtn(onclick = 'cClicked()') Start Order

                .cart-a
                    <form action="/scents/done" method="post" id="payment-form">
                        <div class="form-row">
                            <label for="deliverymethod">Choose a delivery method:</label>
                            <select class='custom-select' id="deliverymethod" name="deliveymethod" style='display: block;'>
                                <option value="postro">Posta Romana</option>
                                <option value="curier">Curier</option>
                            </select>
                            <label for="addressnr">Choose a delivery method:</label>
                            <select  class='custom-select' id="addressnr" name="addressnr" style='display: block;'>
                                - var i=0
                                for address in user.addresses 
                                    option(value=i) Address #{i+1}
                                    - i++
                            </select>
                        </div>
                    </form>
                    .footer-a
                        span.total 
                        span Transport: 0.00 Lei
                        .btn.donebutton.ndcolor.btn.largebtn(onclick = 'doneClicked()') Finish Order
                        .btn.backbutton.ndcolor.btn.largebtn(onclick = 'backClicked()') Back
        script(src='/javascripts/select.js')
        script.
            currentuser = '#{user.username}'
        script(src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js")

        script(src='../javascripts/dot.js')
